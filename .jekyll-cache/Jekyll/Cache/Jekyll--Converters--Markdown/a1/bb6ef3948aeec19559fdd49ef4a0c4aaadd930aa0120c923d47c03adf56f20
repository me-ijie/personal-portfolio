I"><p>è¿™æ¬¡â€œæ— æ³•è·å–æŠ¥é”™ä¿¡æ¯â€çš„é—®é¢˜ï¼Œç»è¿‡æ’æŸ¥æ€»ç»“ï¼Œæ˜¯ç”± Promise å¯¹è±¡ä½¿ç”¨ä¸å½“å¼•èµ·çš„ï¼Œå› æ­¤æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ Promise å¯¹è±¡çš„ä½¿ç”¨ã€‚</p>

<h1 id="promiseå¯¹è±¡çš„ä½¿ç”¨">Promiseå¯¹è±¡çš„ä½¿ç”¨</h1>

<h2 id="promiseå¯¹è±¡">Promiseå¯¹è±¡</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆ›é€ Promiseå¯¹è±¡å®ä¾‹</span>
<span class="kd">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ... some code</span>
	<span class="c1">// åœ¨å†…éƒ¨è®¾å®šå¼‚æ­¥æ“ä½œæˆåŠŸ/å¤±è´¥çš„åˆ¤æ–­æ¡ä»¶</span>
  <span class="k">if</span> <span class="p">(</span><span class="cm">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span><span class="p">){</span>
    <span class="nx">resolve</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="thenæ–¹æ³•">then()æ–¹æ³•</h2>

<p>è°ƒç”¨<code class="language-plaintext highlighter-rouge">resolve</code>æˆ–<code class="language-plaintext highlighter-rouge">reject</code>ä»¥åï¼ŒPromise çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œåç»§æ“ä½œåº”è¯¥æ”¾åˆ°<code class="language-plaintext highlighter-rouge">then</code>æ–¹æ³•é‡Œé¢ã€‚æˆ‘ä»¬ç”¨<code class="language-plaintext highlighter-rouge">then</code>æŒ‡å®šå¼‚æ­¥æ“ä½œæˆåŠŸä¸º<code class="language-plaintext highlighter-rouge">resolved</code>çŠ¶æ€å’Œå¤±è´¥<code class="language-plaintext highlighter-rouge">rejected</code>çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// success</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// failure</span>
<span class="p">});</span>
</code></pre></div></div>

<p>è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">value</code>å’Œ<code class="language-plaintext highlighter-rouge">error</code>å…¶å®æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œéƒ½æ˜¯<code class="language-plaintext highlighter-rouge">Promise</code>å¯¹è±¡ä¼ å‡ºçš„å€¼ã€‚åªæ˜¯å¦‚æœæ“ä½œæˆåŠŸï¼Œå€¼å°±ä¼šè¢«ä¼ ç»™ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼›æ“ä½œå¤±è´¥ï¼Œå€¼ä¼šè¢«ä¼ ç»™ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ã€‚</p>

<h2 id="catchæ–¹æ³•">catch()æ–¹æ³•</h2>

<p>å¦‚æœå¼‚æ­¥æ“ä½œæŠ›å‡ºé”™è¯¯ï¼ŒçŠ¶æ€å°±ä¼šå˜ä¸º<code class="language-plaintext highlighter-rouge">rejected</code>ï¼Œå°±ä¼šè°ƒç”¨<code class="language-plaintext highlighter-rouge">catch()</code>æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œå¤„ç†è¿™ä¸ªé”™è¯¯ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">promise</span>
<span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{},</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{})</span>
<span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{})</span>
</code></pre></div></div>

<p>æ—¢ç„¶å¯ä»¥åœ¨<code class="language-plaintext highlighter-rouge">then</code>ä¸­æŒ‡å®šæ“ä½œå¤±è´¥çš„å›è°ƒå‡½æ•°ï¼ˆ<code class="language-plaintext highlighter-rouge">then</code>çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆåˆéœ€è¦<code class="language-plaintext highlighter-rouge">catch</code>å‘¢ï¼Ÿ</p>

<p><code class="language-plaintext highlighter-rouge">reject()</code>æ–¹æ³•çš„ä½œç”¨ï¼Œå…¶å®å°±ç­‰åŒäºæŠ›å‡ºé”™è¯¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸åœ¨<code class="language-plaintext highlighter-rouge">then()</code>æ–¹æ³•é‡Œé¢å®šä¹‰ Reject çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼ˆå³<code class="language-plaintext highlighter-rouge">then</code>çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œè€Œæ€»æ˜¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">catch</code>æ–¹æ³•ã€‚</p>

<p>å¹¶ä¸”ï¼Œ<code class="language-plaintext highlighter-rouge">catch</code>è¿˜æœ‰å¦å¤–ä¸€ä¸ªä½œç”¨ï¼šå®ƒä¸ä»…èƒ½æ•è·<code class="language-plaintext highlighter-rouge">Promise</code>çš„é”™è¯¯ï¼Œä¹Ÿèƒ½æ•è·<code class="language-plaintext highlighter-rouge">then</code>çš„é”™è¯¯ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨<code class="language-plaintext highlighter-rouge">catch()</code>æ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼Œ<code class="language-plaintext highlighter-rouge">Promiseå¯¹è±¡</code>æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”ã€‚</p>

<h2 id="thençš„å›è°ƒå‡½æ•°">then()çš„å›è°ƒå‡½æ•°</h2>

<p><code class="language-plaintext highlighter-rouge">then()</code>æ¥å—çš„ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œæ˜¯å¯é€‰çš„ï¼Œå³ä½ å¯ä»¥ä¸è®¾ç½®å›è°ƒå‡½æ•°ã€‚å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç”¨æˆ‘ä»¬è‡ªå·±çš„ä»£ç ä¸¾ä¾‹ï¼š</p>

<ul>
  <li>ä¸ä½¿ç”¨<code class="language-plaintext highlighter-rouge">then</code>è®¾ç½®å›è°ƒå‡½æ•°</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// request.js</span>
<span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ... some code</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="k">else</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">};</span>
<span class="c1">// app.js</span>
<span class="k">async</span> <span class="nx">globalRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">requestFunc</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="c1">// åŸæœ¬åº”æ¥ç€å†™.then(()=&gt;{})</span>
 <span class="p">}</span>
</code></pre></div></div>

<p>ç»“æœæ˜¯<code class="language-plaintext highlighter-rouge">result</code>å³ä¸º<code class="language-plaintext highlighter-rouge">resolve(res.data)</code>ä¸­æ‹¿åˆ°çš„<code class="language-plaintext highlighter-rouge">res.data</code>ï¼Œè¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬ä¸æŒ‡å®šå›è°ƒå‡½æ•°æ—¶ï¼Œä¼šé»˜è®¤è¿”å›<code class="language-plaintext highlighter-rouge">resolve()</code>æ‹¿åˆ°çš„å€¼ã€‚</p>

<ul>
  <li>è®¾ç½®<code class="language-plaintext highlighter-rouge">then</code>ä¸­ResolvedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼ˆå³ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nx">globalRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">requestFunc</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
      <span class="c1">// åªæ‰“å°æ‹¿åˆ°çš„å€¼ï¼Œä¸return value</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>ç»“æœä¾¿æ˜¯æ‰“å°äº†<code class="language-plaintext highlighter-rouge">res.data</code>ï¼Œ<code class="language-plaintext highlighter-rouge">result</code>ä¸º<code class="language-plaintext highlighter-rouge">undefined</code>ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å°†å€¼è¿”å›ã€‚</p>

<ul>
  <li>ä¸è®¾ç½®<code class="language-plaintext highlighter-rouge">then</code>ä¸­RejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼ˆå³ç¬¬äºŒä¸ªå‚æ•°ï¼‰</li>
</ul>

<p>ä»£ç åŒä¸Šï¼Œå¼‚æ­¥æ“ä½œæˆåŠŸï¼Œä¸ä¼šæŠ¥é”™ï¼›å¼‚æ­¥æ“ä½œå¤±è´¥ï¼Œç”±äºæ²¡æœ‰å¯¹<code class="language-plaintext highlighter-rouge">reject()</code>åšä»»ä½•åç»­å¤„ç†ï¼Œæ‰€ä»¥å¤–éƒ¨ä¹Ÿæ¥å—ä¸åˆ°ä»»ä½•ä¿¡æ¯ã€‚</p>

<h1 id="é—®é¢˜ä»£ç å¤ç°">é—®é¢˜ä»£ç å¤ç°</h1>

<ol>
  <li>æˆ‘ä»¬åœ¨<code class="language-plaintext highlighter-rouge">request.js</code>ä¸­åˆ›é€ äº†Promiseå¯¹è±¡å®ä¾‹ï¼Œå¹¶æ ¹æ®è¿”å›çš„çŠ¶æ€ç æ¥åˆ¤å®šå¼‚æ­¥æ“ä½œæ˜¯å¦æˆåŠŸã€‚</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">wx</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
			<span class="c1">// ... some code</span>
			<span class="nx">success</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
					<span class="k">else</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
				<span class="p">}</span>
		<span class="p">})</span>
	<span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>æˆ‘ä»¬åœ¨<code class="language-plaintext highlighter-rouge">app.js</code>ä¸­æ‹¿åˆ°<code class="language-plaintext highlighter-rouge">request</code>è¿”å›çš„å€¼ã€‚</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nx">globalRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">requestFunc</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="c1">// ... some code</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">code</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">){</span> 
    <span class="c1">// ... some code</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>æ‰€æœ‰è¯·æ±‚æˆåŠŸï¼ˆ<code class="language-plaintext highlighter-rouge">res.data.code === 0 || res.data.code == 200</code>ï¼‰çš„æƒ…å†µä¸‹ï¼Œ<code class="language-plaintext highlighter-rouge">res.data</code>éƒ½ä¼šè¢«èµ‹å€¼ç»™<code class="language-plaintext highlighter-rouge">app.js</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">result</code>ã€‚ï¼ˆæœªæŒ‡å®šå›è°ƒå‡½æ•°æ—¶ï¼Œé»˜è®¤è¿”å›<code class="language-plaintext highlighter-rouge">resolve()</code>æ‹¿åˆ°çš„å€¼ï¼‰ã€‚</p>

<p>åœ¨<code class="language-plaintext highlighter-rouge">app.js</code>ä¸­ï¼Œæ ¹æœ¬ä¸ä¼šå­˜åœ¨<code class="language-plaintext highlighter-rouge">res.code != 0</code>æˆ–æ˜¯<code class="language-plaintext highlighter-rouge">res.code ï¼= 200</code>çš„æƒ…å†µï¼Œå› ä¸ºè¿™ç§æƒ…å†µå·²ç»åœ¨<code class="language-plaintext highlighter-rouge">request.js</code>ä¸­è¢«åˆ¤å®šä¸ºå¼‚æ­¥æ“ä½œå¤±è´¥è€Œå°†é”™è¯¯ä¿¡æ¯ä¼ ç»™<code class="language-plaintext highlighter-rouge">reject()</code>äº†ã€‚</p>

<p>ä¸ºä»€ä¹ˆå•é¡µé¢ä¸­æ‹¿ä¸åˆ°æŠ¥é”™ä¿¡æ¯ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡æœ‰é€šè¿‡<code class="language-plaintext highlighter-rouge">catch()</code>å»æ•è·åŠå¤„ç†é”™è¯¯ä¿¡æ¯ã€‚</p>

<h1 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h1>

<p>è¦æ•è·é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä½œå‡ºç›¸åº”å¤„ç†ï¼Œå°±è¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">catch()</code>æ–¹æ³•ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">async</span> <span class="nx">globalRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">requestFunc</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="c1">//  ä½¿ç”¨catch()æ–¹æ³•æ•è·é”™è¯¯</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
 		<span class="c1">// ... ä½œå‡ºç›¸åº”çš„å¤„ç†</span>
      <span class="p">})</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="nx">result</span>
  <span class="p">}</span>
</code></pre></div></div>

<h1 id="å‚è€ƒé˜…è¯»">å‚è€ƒé˜…è¯»</h1>

:ET